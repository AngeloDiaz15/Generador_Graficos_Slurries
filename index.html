<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Generador de Archivos .fth</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.0/jszip.min.js"></script>
</head>
<body>
  <h2>Generador de configuraciones .fth por % de sólidos</h2>

  <label for="fileInput">Subir archivo .fth:</label>
  <input type="file" id="fileInput" accept=".fth"><br><br>

  <label for="inicio">Desde (%):</label>
  <input type="number" id="inicio" value="5" min="1" max="100">
  <label for="fin">Hasta (%):</label>
  <input type="number" id="fin" value="60" min="1" max="100"><br><br>

  <label for="densidad">Densidad del sólido (kg/m³):</label>
  <input type="number" id="densidad" value="8900" min="1"><br><br>

  <button onclick="generarArchivos()">Generar archivos</button><br><br>
  <a id="descargarZip" style="display:none;">Descargar archivos .zip</a>

  <script>
    function generarArchivos() {
      const input = document.getElementById('fileInput');
      const desde = parseInt(document.getElementById('inicio').value);
      const hasta = parseInt(document.getElementById('fin').value);
      const densidadSolido = document.getElementById('densidad').value;

      if (!input.files[0]) {
        alert('Por favor, sube un archivo .fth primero');
        return;
      }
      if (desde < 1 || hasta > 100 || desde > hasta) {
        alert('Rango inválido. Asegúrate de que el rango esté entre 1% y 100% y que el inicio no sea mayor al final.');
        return;
      }
      if (!densidadSolido || isNaN(densidadSolido)) {
        alert('Por favor, ingresa un valor válido de densidad del sólido.');
        return;
      }

      const reader = new FileReader();
      reader.onload = function(event) {
        const contenido = event.target.result;
        const zip = new JSZip();
        const regex_conc = /,2,\d{1,3},Percent/g; // Coincidencia exacta para % sólidos
        const regex_dens = /,1,kg\/m3,1,\d+(\.\d+)?/g; // Coincidencia para densidad del sólido

        for (let ss = desde; ss <= hasta; ss += 5) {
          let modificado = contenido.replaceAll(regex_conc, `,2,${ss},Percent`);
          modificado = modificado.replaceAll(regex_dens, `,1,kg/m3,1,${densidadSolido}`);
          zip.file(`modelo_${ss}.fth`, modificado);
        }

        zip.generateAsync({ type: 'blob' })
          .then(function(content) {
            const enlace = document.getElementById('descargarZip');
            enlace.href = URL.createObjectURL(content);
            enlace.download = 'modelos_generados.zip';
            enlace.textContent = 'Descargar modelos_generados.zip';
            enlace.style.display = 'inline';
          });
      };

      reader.readAsText(input.files[0]);
    }
  </script>
</body>
</html>

