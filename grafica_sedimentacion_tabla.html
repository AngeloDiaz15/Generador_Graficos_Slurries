<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Mapa de Calor de Sedimentación</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
    }
    h2 {
      text-align: center;
    }
    table {
      width: auto;
      border-collapse: collapse;
      margin: 0 auto;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: center;
    }
    th {
      background-color: #f2f2f2;
    }
    .rojo-oscuro {
      background-color: #8B0000;
      color: white;
    }
    .rojo-claro {
      background-color: #FF6347;
      color: white;
    }
    .naranja {
      background-color: #FFA500;
      color: black;
    }
    .amarillo {
      background-color: #FFFF99;
      color: black;
    }
  </style>
</head>
<body>
  <h2>Mapa de Calor de Sedimentación (Vm/Vsm)</h2>
  <div id="tablaCalor"></div>

  <script>
    // Leer datos desde localStorage
    const datosResumen = JSON.parse(localStorage.getItem("resumenDatos"));

    // Agrupar los datos por tubería y %SS
    const tuberias = [...new Set(datosResumen.map(d => d.Tuberia))];
    const concentraciones = [...new Set(datosResumen.map(d => d.SS))].sort((a, b) => a - b);

    // Crear un objeto para mapear los valores Vm/Vsm por tubería y concentración
    const mapaValores = {};
    tuberias.forEach(t => mapaValores[t] = {});

    datosResumen.forEach(d => {
      mapaValores[d.Tuberia][d.SS] = parseFloat(d.Vm_Vsm.toFixed(3));
    });

    // Función para asignar clases de color según rango de valor
    function obtenerClaseColor(valor) {
      if (valor < 1) return "rojo-oscuro";
      else if (valor >= 1 && valor <= 1.05) return "rojo-claro";
      else if (valor > 1.05 && valor <= 1.1) return "naranja";
      else if (valor > 1.1 && valor <= 1.3) return "amarillo";
      else return "";
    }

    // Crear la tabla HTML
    const contenedor = document.getElementById("tablaCalor");
    let tablaHTML = "<table><thead><tr><th>Tubería</th>";
    concentraciones.forEach(c => {
      tablaHTML += `<th>${c}% SS</th>`;
    });
    tablaHTML += "</tr></thead><tbody>";

    tuberias.forEach(tub => {
      tablaHTML += `<tr><th>${tub}</th>`;
      concentraciones.forEach(c => {
        const valor = mapaValores[tub][c];
        if (valor !== undefined) {
          const clase = obtenerClaseColor(valor);
          tablaHTML += `<td class="${clase}">${valor}</td>`;
        } else {
          tablaHTML += `<td></td>`;
        }
      });
      tablaHTML += "</tr>";
    });

    tablaHTML += "</tbody></table>";
    contenedor.innerHTML = tablaHTML;
  </script>
</body>
</html>

